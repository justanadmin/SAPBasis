#!/bin/bash

source_path="$1"
target_path="$2"

if [[ -z $source_path || -z $target_path ]]; then
  echo "Usage: ./compare_ini.sh <source_directory_path> <target_directory_path>"
  exit 1
fi

if [[ ! -d $source_path || ! -d $target_path ]]; then
  echo "Invalid directory path(s). Please provide valid paths for source and target directories."
  exit 1
fi

for source_file in "$source_path"/*.ini; do
  file_name=$(basename "$source_file")
  target_file="$target_path/$file_name"

  if [[ -f $target_file ]]; then
    echo "File: $file_name"
    echo "-------------------"
    section=""
    while IFS='=' read -r key value || [[ -n $key ]]; do
      if [[ $key ]]; then
        target_value=$(awk -F= -v k="$key" '$1 == k {print $2}' "$target_file")
        if [[ $value != "$target_value" ]]; then
          if [[ -z $section ]]; then
            section=$(awk -F'[][]' '/^\[.*\]/ {print $2}' "$source_file")
            echo "Section: $section"
          fi
          echo "   Parameter: $key"
          echo "      Source: $value"
          echo "      Target: $target_value"
          echo ""
        fi
      fi
    done < "$source_file"
  else
    echo "Target file not found: $target_file"
  fi
done
